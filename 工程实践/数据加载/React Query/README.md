# React Query

React Query ä¸ºæˆ‘ä»¬æä¾›äº†è¯¸å¦‚ useQuery ä¹‹ç±»çš„è‡ªå®šä¹‰é’©å­æ¥è·å–æ•°æ®ã€‚åœ¨åå°ï¼Œè¿™äº›æŒ‚é’©ç®¡ç†è®¸å¤šäº‹æƒ…ï¼Œä¾‹å¦‚åœ¨åˆå§‹è·å–åç¼“å­˜æ•°æ®ï¼Œåœ¨åå°é‡æ–°è·å–æ•°æ®ç­‰ã€‚React Query ç»å¸¸è¢«æè¿°ä¸º React ç¼ºå¤±çš„æ•°æ®è·å–åº“ï¼Œä½†åœ¨æ›´å¤šçš„æŠ€æœ¯æœ¯è¯­ä¸­ï¼Œå®ƒä½¿ä½ çš„ React åº”ç”¨ç¨‹åºä¸­è·å–ã€ç¼“å­˜ã€åŒæ­¥å’Œæ›´æ–°æœåŠ¡å™¨çŠ¶æ€å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚

# Motivation

å¼€ç®±å³ç”¨çš„ React åº”ç”¨ç¨‹åºå¹¶æ²¡æœ‰æä¾›ä»ç»„ä»¶ä¸­è·å–æˆ–æ›´æ–°æ•°æ®çš„æ„è§ï¼Œæ‰€ä»¥å¼€å‘è€…æœ€ç»ˆè¦å»ºç«‹è‡ªå·±çš„è·å–æ•°æ®çš„æ–¹å¼ã€‚è¿™é€šå¸¸æ„å‘³ç€ä½¿ç”¨ React é’©å­æŠŠåŸºäºç»„ä»¶çš„çŠ¶æ€å’Œæ•ˆæœæ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œæˆ–è€…ä½¿ç”¨æ›´é€šç”¨çš„çŠ¶æ€ç®¡ç†åº“æ¥å­˜å‚¨å’Œæä¾›æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å¼‚æ­¥æ•°æ®ã€‚è™½ç„¶å¤§å¤šæ•°ä¼ ç»Ÿçš„çŠ¶æ€ç®¡ç†åº“åœ¨å¤„ç†å®¢æˆ·ç«¯çŠ¶æ€æ–¹é¢å¾ˆå‡ºè‰²ï¼Œä½†å®ƒä»¬åœ¨å¤„ç†å¼‚æ­¥æˆ–æœåŠ¡å™¨çŠ¶æ€æ–¹é¢å´ä¸é‚£ä¹ˆå‡ºè‰²ã€‚è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨çŠ¶æ€æ˜¯å®Œå…¨ä¸åŒçš„ã€‚é¦–å…ˆï¼ŒæœåŠ¡å™¨çŠ¶æ€ï¼š

- åœ¨ä¸€ä¸ªä½ ä¸æ§åˆ¶æˆ–ä¸æ‹¥æœ‰çš„åœ°æ–¹è¢«è¿œç¨‹æŒä¹…åŒ–
- éœ€è¦å¼‚æ­¥çš„ API æ¥è·å–å’Œæ›´æ–°
- æ„å‘³ç€å…±äº«æ‰€æœ‰æƒï¼Œå¯ä»¥åœ¨ä½ ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«å…¶ä»–äººæ”¹å˜
- å¦‚æœä½ ä¸å°å¿ƒï¼Œæœ‰å¯èƒ½åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­å˜å¾—è¿‡æ—¶ã€‚

ä¸€æ—¦ä½ æŒæ¡äº†åº”ç”¨ç¨‹åºä¸­æœåŠ¡å™¨çŠ¶æ€çš„æ€§è´¨ï¼Œç”šè‡³æ›´å¤šçš„æŒ‘æˆ˜ä¼šéšç€ä½ çš„å‘å±•è€Œå‡ºç°ï¼Œæ¯”å¦‚è¯´ã€‚

- ç¼“å­˜... (å¯èƒ½æ˜¯ç¼–ç¨‹ä¸­æœ€éš¾åšåˆ°çš„äº‹æƒ…)
- å°†å¯¹åŒä¸€æ•°æ®çš„å¤šä¸ªè¯·æ±‚ç®€åŒ–ä¸ºä¸€ä¸ªè¯·æ±‚
- åœ¨åå°æ›´æ–°è¿‡æ—¶çš„æ•°æ®
- çŸ¥é“æ•°æ®ä½•æ—¶è¿‡æœŸ
- å°½å¯èƒ½å¿«åœ°åæ˜ æ•°æ®çš„æ›´æ–°
- æ€§èƒ½ä¼˜åŒ–ï¼Œå¦‚åˆ†é¡µå’Œæ‡’æƒ°åŠ è½½æ•°æ®
- ç®¡ç†å†…å­˜å’ŒæœåŠ¡å™¨çŠ¶æ€çš„åƒåœ¾æ”¶é›†
- ç”¨ç»“æ„å…±äº«æ¥è®°å¿†æŸ¥è¯¢ç»“æœ

å¦‚æœä½ æ²¡æœ‰è¢«è¿™ä¸ªæ¸…å•å‹å€’ï¼Œé‚£ä¹ˆè¿™ä¸€å®šæ„å‘³ç€ä½ å¯èƒ½å·²ç»è§£å†³äº†æ‰€æœ‰çš„æœåŠ¡å™¨çŠ¶æ€é—®é¢˜ï¼Œå¹¶åº”è¯¥è·å¾—å¥–åŠ±ã€‚ç„¶è€Œï¼Œå¦‚æœä½ åƒç»å¤§å¤šæ•°äººä¸€æ ·ï¼Œä½ è¦ä¹ˆè¿˜æ²¡æœ‰è§£å†³æ‰€æœ‰è¿™äº›æŒ‘æˆ˜ï¼Œè¦ä¹ˆè¿˜æ²¡æœ‰è§£å†³å¤§éƒ¨åˆ†æŒ‘æˆ˜ï¼Œè€Œæˆ‘ä»¬åªæ˜¯åœ¨æŠ“ç´§æ—¶é—´ã€‚React Query æ˜¯ç®¡ç†æœåŠ¡å™¨çŠ¶æ€çš„æœ€ä½³åº“ä¹‹ä¸€ã€‚å®ƒå¼€ç®±å³ç”¨ï¼Œé›¶é…ç½®ï¼Œæ•ˆæœæƒŠäººï¼Œè€Œä¸”å¯ä»¥éšç€ä½ çš„åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼ŒæŒ‰ç…§ä½ çš„å–œå¥½è¿›è¡Œå®šåˆ¶ã€‚React æŸ¥è¯¢å…è®¸ä½ å‡»è´¥å¹¶å…‹æœæœåŠ¡å™¨çŠ¶æ€çš„æ£˜æ‰‹æŒ‘æˆ˜å’Œéšœç¢ï¼Œåœ¨ä½ çš„åº”ç”¨ç¨‹åºæ•°æ®å¼€å§‹æ§åˆ¶ä½ ä¹‹å‰æ§åˆ¶å®ƒã€‚åœ¨æ›´å¤šçš„æŠ€æœ¯æ–¹é¢ï¼ŒReact Query å°†å¯èƒ½ã€‚

- å¸®åŠ©ä½ ä»ä½ çš„åº”ç”¨ç¨‹åºä¸­åˆ é™¤è®¸å¤šå¤æ‚çš„å’Œè¢«è¯¯è§£çš„ä»£ç ï¼Œåªç”¨å°‘æ•°å‡ è¡Œ React Query é€»è¾‘æ¥ä»£æ›¿ã€‚
- ä½¿ä½ çš„åº”ç”¨ç¨‹åºæ›´æ˜“ç»´æŠ¤ï¼Œæ›´å®¹æ˜“å»ºç«‹æ–°çš„åŠŸèƒ½ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ–°çš„æœåŠ¡å™¨çŠ¶æ€æ•°æ®æºçš„æ¥çº¿é—®é¢˜
- é€šè¿‡ä½¿ä½ çš„åº”ç”¨ç¨‹åºæ„Ÿè§‰æ¯”ä»¥å‰æ›´å¿«ã€æ›´çµæ•ï¼Œå¯¹ä½ çš„ç»ˆç«¯ç”¨æˆ·äº§ç”Ÿç›´æ¥å½±å“ã€‚
- æ½œåœ¨åœ°å¸®åŠ©ä½ èŠ‚çœå¸¦å®½å’Œæé«˜å†…å­˜æ€§èƒ½

# å¯¹æ¯”

| Comparsion                              | React Query                                                                                                                              | SWR [_(Website)_](https://github.com/vercel/swr)                                                               | Apollo Client [_(Website)_](https://github.com/apollographql/apollo-client)                                                                  | RTK-Query [_(Website)_](https://redux-toolkit.js.org/rtk-query/overview)                                                                                 |
| :-------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Github Repo / Stars                     | [![img](https://img.shields.io/github/stars/tannerlinsley/react-query?label=%F0%9F%8C%9F)](https://github.com/tannerlinsley/react-query) | [![img](https://img.shields.io/github/stars/vercel/swr?label=%F0%9F%8C%9F)](https://github.com/vercel/swr)     | [![img](https://img.shields.io/github/stars/apollographql/apollo-client?label=%F0%9F%8C%9F)](https://github.com/apollographql/apollo-client) | [![img](https://img.shields.io/github/stars/rtk-incubator/rtk-query?label=%F0%9F%8C%9F)](https://github.com/rtk-incubator/rtk-query)                     |
| Platform Requirements                   | React                                                                                                                                    | React                                                                                                          | React, GraphQL                                                                                                                               | Redux                                                                                                                                                    |
| Their Comparison                        |                                                                                                                                          | (none)                                                                                                         | (none)                                                                                                                                       | [Comparison](https://redux-toolkit.js.org/rtk-query/comparison)                                                                                          |
| Supported Query Syntax                  | Promise, REST, GraphQL                                                                                                                   | Promise, REST, GraphQL                                                                                         | GraphQL                                                                                                                                      | Promise, REST, GraphQL                                                                                                                                   |
| Supported Frameworks                    | React                                                                                                                                    | React                                                                                                          | React + Others                                                                                                                               | Any                                                                                                                                                      |
| Supported Query Keys                    | JSON                                                                                                                                     | JSON                                                                                                           | GraphQL Query                                                                                                                                | JSON                                                                                                                                                     |
| Query Key Change Detection              | Deep Compare (Stable Serialization)                                                                                                      | Referential Equality (===)                                                                                     | Deep Compare (Unstable Serialization)                                                                                                        | Referential Equality (===)                                                                                                                               |
| Query Data Memoization Level            | Query + Structural Sharing                                                                                                               | Query                                                                                                          | Query + Entity + Structural Sharing                                                                                                          | Query                                                                                                                                                    |
| Bundle Size                             | [![img](https://badgen.net/bundlephobia/minzip/react-query?label=%F0%9F%92%BE)](https://bundlephobia.com/result?p=react-query)           | [![img](https://badgen.net/bundlephobia/minzip/swr?label=%F0%9F%92%BE)](https://bundlephobia.com/result?p=swr) | [![img](https://badgen.net/bundlephobia/minzip/@apollo/client?label=%F0%9F%92%BE)](https://bundlephobia.com/result?p=@apollo/client)         | [![img](https://badgen.net/bundlephobia/minzip/@rtk-incubator/rtk-query?label=%F0%9F%92%BE)](https://bundlephobia.com/result?p=@rtk-incubator/rtk-query) |
| API Definition                          | On-Use, Declarative                                                                                                                      | On-Use                                                                                                         | GraphQL Schema                                                                                                                               | Declarative                                                                                                                                              |
| Queries                                 | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Caching                                 | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Devtools                                | âœ…                                                                                                                                       | ğŸŸ¡                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Polling/Intervals                       | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Parallel Queries                        | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Dependent Queries                       | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Paginated Queries                       | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Infinite Queries                        | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Bi-directional Infinite Queries         | âœ…                                                                                                                                       | ğŸ”¶                                                                                                             | ğŸ”¶                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Infinite Query Refetching               | âœ…                                                                                                                                       | âœ…                                                                                                             | ğŸ›‘                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Lagged Query Data1                      | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Selectors                               | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Initial Data                            | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Scroll Recovery                         | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Cache Manipulation                      | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Outdated Query Dismissal                | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Render Optimization2                    | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Auto Garbage Collection                 | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Mutation Hooks                          | âœ…                                                                                                                                       | ğŸŸ¡                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Offline Mutation Support                | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸŸ¡                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Prefetching APIs                        | âœ…                                                                                                                                       | ğŸ”¶                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Query Cancellation                      | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Partial Query Matching3                 | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Stale While Revalidate                  | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Stale Time Configuration                | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Pre-usage Query/Mutation Configuration4 | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | ğŸ›‘                                                                                                                                           | âœ…                                                                                                                                                       |
| Window Focus Refetching                 | âœ…                                                                                                                                       | âœ…                                                                                                             | ğŸ›‘                                                                                                                                           | ğŸ”¶                                                                                                                                                       |
| Network Status Refetching               | âœ…                                                                                                                                       | âœ…                                                                                                             | âœ…                                                                                                                                           | ğŸ”¶                                                                                                                                                       |
| General Cache Dehydration/Rehydration   | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Offline Caching                         | âœ… (Experimental)                                                                                                                        | ğŸ›‘                                                                                                             | âœ…                                                                                                                                           | ğŸ”¶                                                                                                                                                       |
| React Suspense (Experimental)           | âœ…                                                                                                                                       | âœ…                                                                                                             | ğŸ›‘                                                                                                                                           | ğŸ›‘                                                                                                                                                       |
| Abstracted/Agnostic Core                | âœ…                                                                                                                                       | ğŸ›‘                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Automatic Refetch after Mutation5       | ğŸ”¶                                                                                                                                       | ğŸ”¶                                                                                                             | âœ…                                                                                                                                           | âœ…                                                                                                                                                       |
| Normalized Caching6                     | ğŸ›‘                                                                                                                                       | ğŸ›‘                                                                                                             | âœ…                                                                                                                                           | ğŸ›‘                                                                                                                                                       |

# Hello World

```ts
import { QueryClient, QueryClientProvider, useQuery } from "react-query";

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  const { isLoading, error, data } = useQuery("repoData", () =>
    fetch("https://api.github.com/repos/tannerlinsley/react-query").then(
      (res) => res.json()
    )
  );

  if (isLoading) return "Loading...";

  if (error) return "An error has occurred: " + error.message;

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{" "}
      <strong>âœ¨ {data.stargazers_count}</strong>{" "}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  );
}
```

å¦‚æœå¸Œæœ›åœ¨ç±»ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå¯ä»¥é‡‡å–å¦‚ä¸‹æ–¹å¼ï¼š

```tsx
function UseQuery (props) {
  return props.children(useQuery(props.key, props.fn, props.options))
}

<UseQuery
  key=â€œtodosâ€
  fn={() => getTodos()}
  options={{ staleTime: 5000 }}
>
  {query => {. . .}}
</UseQuery>
```
